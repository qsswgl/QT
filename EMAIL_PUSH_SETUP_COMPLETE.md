# ✅ 邮件推送设置完成

## 📧 配置信息

已成功配置邮件推送服务:

| 项目 | 信息 |
|:-----|:-----|
| **发件邮箱** | qsoft@139.com |
| **收件邮箱** | qsoft@139.com |
| **SMTP服务器** | smtp.139.com |
| **端口** | 25 (TLS) |
| **状态** | ✅ 已测试通过 |

---

## 🎯 邮件推送功能

### 自动发送的邮件类型

#### 1. 🚨 交易信号提醒

**触发条件**: 检测到新的买入/卖出信号

**邮件内容**:
- ✅ 信号日期
- ✅ 股票代码 (TSLA)
- ✅ 交易动作 (买入/卖出)
- ✅ 建议数量
- ✅ 参考价格
- ✅ 预估总金额
- ✅ 信号原因
- ✅ 执行步骤说明
- ✅ Firstrade链接

**邮件示例**:
```
主题: [TSLA策略] 🚨 TSLA 买入信号!

内容:
━━━━━━━━━━━━━━━━━━━
🚨 交易信号提醒
━━━━━━━━━━━━━━━━━━━

📊 信号详情
  • 信号日期: 2025-11-12
  • 股票代码: TSLA
  • 交易动作: 买入 (BUY)
  • 建议数量: 2,076 股
  • 参考价格: $250.50
  • 预估总额: $520,038.00
  • 信号原因: 趋势确认 + 强势突破信号

⚠️ 重要提示
  • 请在美股交易时间内执行
  • 确认账户有足够资金
  • 建议使用市价单快速成交
  • 执行后请记录订单号

[🔗 登录 Firstrade 执行交易]
━━━━━━━━━━━━━━━━━━━
```

---

#### 2. ✅ 每周检查完成通知

**触发条件**: 无新信号,策略正常运行

**邮件内容**:
- ✅ 检查时间
- ✅ 运行状态
- ✅ 无需操作提示

**邮件示例**:
```
主题: [TSLA策略] ✅ 每周检查完成 - 无新信号

内容:
━━━━━━━━━━━━━━━━━━━
✅ 每周检查完成
━━━━━━━━━━━━━━━━━━━

📊 检查结果
  暂无新交易信号
  策略运行正常,继续持有当前仓位即可

💡 提示
  无需任何操作,下周继续自动检查

📅 检查时间: 2025-11-12 20:00:00
━━━━━━━━━━━━━━━━━━━
```

---

#### 3. ⚠️ 错误通知

**触发条件**: 策略运行失败

**邮件内容**:
- ⚠️ 错误信息
- ⚠️ 处理建议

---

## 🚀 使用方法

### 方法1: 手动运行 (推荐开始时)

```bash
双击运行: K:\QT\weekly_check_email.bat
```

**流程**:
1. 更新TSLA数据
2. 运行策略
3. 检查信号
4. 发送邮件

**时间**: 约2-3分钟

---

### 方法2: 自动运行 (推荐长期)

设置Windows计划任务,每周自动运行:

**步骤**:
1. 按 `Win + R`,输入 `taskschd.msc`
2. 创建基本任务
3. 名称: `TSLA策略每周检查-邮件推送`
4. 触发器: 每周日 晚上8点
5. 操作: 启动程序
6. 程序路径: `K:\QT\weekly_check_email.bat`
7. 完成设置

**详细教程**: 参考 `SETUP_WEEKLY_REMINDER.md`

---

## 📱 收到邮件后的操作

### 如果是信号提醒 🚨

**立即行动**:
1. ✅ 阅读邮件中的信号详情
2. ✅ 在美股交易时间登录Firstrade
3. ✅ 按照邮件中的步骤执行交易
4. ✅ 记录订单号和成交价格
5. ✅ 在 `TRADE_EXECUTION_LOG.md` 中记录

**重要**:
- 尽快执行(避免价格大幅变化)
- 确认账户资金充足
- 使用市价单快速成交

---

### 如果是无信号通知 ✅

**无需操作**:
- ✅ 确认邮件收到即可
- ✅ 策略运行正常
- ✅ 下周继续自动检查

---

### 如果是错误通知 ⚠️

**检查处理**:
1. ✅ 查看错误信息
2. ✅ 手动运行 `weekly_check_email.bat` 查看详细错误
3. ✅ 如果是数据更新失败,稍后重试
4. ✅ 如果持续失败,检查网络和配置

---

## ⚙️ 自定义配置

### 修改邮件配置

编辑文件: `src/notification/email_config.py`

```python
# 发件人信息
sender_email: str = "qsoft@139.com"
sender_password: str = "574a283d502db51ea200"

# 收件人信息(可以改成不同邮箱)
recipient_email: str = "qsoft@139.com"

# 邮件主题前缀
subject_prefix: str = "[TSLA策略]"

# 是否启用邮件推送
enabled: bool = True  # 改为False可暂时关闭
```

---

### 禁用邮件推送

如果临时不需要邮件提醒:

**方法1**: 修改配置文件
```python
# src/notification/email_config.py
enabled: bool = False
```

**方法2**: 使用原版脚本
```bash
双击运行: K:\QT\weekly_check.bat  # 不发邮件的版本
```

---

## 🔍 故障排查

### 问题1: 邮件发送失败

**症状**: 显示 "Mail rejected" 或 "Authentication failed"

**可能原因**:
1. SMTP授权码错误
2. 139邮箱发送频率限制
3. 邮箱未开启SMTP服务

**解决方法**:
1. ✅ 检查授权码是否正确
2. ✅ 登录139邮箱确认SMTP服务已开启
3. ✅ 等待几分钟后重试(避免频率限制)
4. ✅ 联系139邮箱客服确认状态

---

### 问题2: 收不到邮件

**症状**: 脚本显示发送成功,但收件箱没有邮件

**可能原因**:
1. 邮件在垃圾邮件箱
2. 邮件延迟到达
3. 邮箱过滤规则

**解决方法**:
1. ✅ 检查垃圾邮件箱
2. ✅ 等待几分钟(有时有延迟)
3. ✅ 将 qsoft@139.com 添加到白名单
4. ✅ 检查邮箱过滤规则

---

### 问题3: 邮件格式异常

**症状**: 邮件显示为纯文本或格式错乱

**可能原因**:
1. 邮件客户端不支持HTML
2. 邮箱安全设置屏蔽HTML

**解决方法**:
1. ✅ 使用网页版邮箱查看
2. ✅ 更换邮件客户端
3. ✅ 调整邮箱安全设置

---

## 💡 使用建议

### 推荐配置

**场景1: 工作日白天无法查看**
- 设置每周日晚上8点自动运行
- 早上上班前查看邮件
- 有信号时当天执行

**场景2: 随时查看**
- 设置每周日晚上8点自动运行
- 手机邮件推送开启
- 随时收到立即查看

**场景3: 测试阶段**
- 手动运行几次熟悉流程
- 确认邮件能正常接收
- 再设置自动运行

---

### 最佳实践

1. **定期检查**: 每周运行一次即可
2. **及时响应**: 有信号时尽快执行
3. **记录详细**: 每次交易都记录
4. **保持联系**: 确保邮箱正常接收

---

## 📊 测试邮件功能

### 单独测试邮件发送

```bash
python -m src.notification.email_service
```

**用途**:
- 验证邮件配置是否正确
- 测试邮件格式是否正常
- 检查邮件发送速度

---

### 完整测试流程

```bash
python -m src.pipeline.run_weekly_check_email
```

**用途**:
- 测试整个检查流程
- 验证信号检测逻辑
- 确认邮件发送时机

---

## 📁 相关文件

```
K:\QT\
├── weekly_check_email.bat                    # ⭐ 邮件推送版检查脚本
├── weekly_check.bat                          # 原版检查脚本(无邮件)
├── src/
│   ├── notification/
│   │   ├── email_config.py                   # 邮件配置
│   │   └── email_service.py                  # 邮件发送服务
│   └── pipeline/
│       └── run_weekly_check_email.py         # 邮件推送版策略检查
├── FIRSTRADE_MANUAL_TRADING_GUIDE.md         # 手动交易指南
├── TRADE_EXECUTION_LOG.md                    # 交易记录模板
└── SETUP_WEEKLY_REMINDER.md                  # 自动提醒设置教程
```

---

## ✅ 下一步

### 现在就试试!

**1. 测试邮件发送**:
```bash
python -m src.notification.email_service
```

**2. 测试完整流程**:
```bash
双击: K:\QT\weekly_check_email.bat
```

**3. 检查邮箱**:
- 打开 qsoft@139.com
- 查找 "[TSLA策略]" 开头的邮件
- 确认邮件格式正常

**4. 设置自动运行**:
- 参考 `SETUP_WEEKLY_REMINDER.md`
- 设置Windows计划任务
- 每周日自动运行

---

## 🎉 总结

你现在拥有:
- ✅ 自动邮件提醒系统
- ✅ 精美的HTML邮件模板
- ✅ 完整的信号检测逻辑
- ✅ 一键运行脚本
- ✅ 自动化方案

**工作流程**:
1. 每周日晚8点自动运行
2. 自动检查信号
3. 自动发送邮件到手机
4. 收到邮件立即查看
5. 有信号则登录Firstrade执行
6. 无信号则无需操作

**这是一个完全自动化的解决方案! 🚀**

---

**需要帮助? 随时告诉我! 💪**
