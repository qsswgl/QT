# 📊 策略执行日志系统使用指南

## 📖 概述

策略执行日志系统帮助您记录每日策略执行情况，并每周进行回顾分析，以评估策略的正确性和有效性。

## 🎯 核心功能

### 1. 自动日志记录
- 每次运行日度策略时自动记录
- 记录市场数据、信号情况、决策依据
- 追踪价格变化和策略表现

### 2. 每周回顾分析
- 分析过去7天的执行记录
- 评估信号准确性
- 识别策略优势和问题
- 提出改进建议

### 3. 数据可视化
- 价格走势对比
- 信号频率统计
- 策略收益分析

## 📁 文件结构

```
K:\QT\
├── STRATEGY_EXECUTION_LOG.md          # 策略执行日志文件
├── daily_strategy_check.bat            # 日度策略批处理（已集成日志功能）
├── log_strategy.bat                    # 单独记录日志
├── weekly_review.bat                   # 周回顾分析
└── src\
    └── pipeline\
        ├── log_strategy_execution.py   # 日志记录脚本
        └── weekly_strategy_review.py   # 周回顾分析脚本
```

## 🚀 快速开始

### 每日使用

1. **运行日度策略（推荐）**
   ```batch
   K:\QT\daily_strategy_check.bat
   ```
   
   这个批处理会自动完成：
   - ✅ 更新数据
   - ✅ 运行策略
   - ✅ 发送邮件
   - ✅ **记录日志** ⬅️ 新增功能

2. **单独记录日志（可选）**
   
   如果需要手动记录日志：
   ```batch
   K:\QT\log_strategy.bat
   ```

### 每周回顾（每周日）

1. **运行周回顾分析**
   ```batch
   K:\QT\weekly_review.bat
   ```

2. **查看并完善分析报告**
   - 打开 `STRATEGY_EXECUTION_LOG.md`
   - 查看自动生成的周回顾报告
   - 填写策略评估和改进建议

## 📋 日志内容说明

### 每日日志包含

#### ✅ 自动记录的信息
- **执行信息**: 时间、策略类型、数据更新状态
- **数据状态**: 最新数据日期、完整性
- **市场状态**: TSLA收盘价、价格变动、成交量
- **信号情况**: 最新信号、信号价格、近7天信号数
- **操作建议**: 基于信号的建议（观望/查看邮件）
- **回顾分析**: 上次操作、当前价格、价差

#### ✏️ 需要手动填写的信息
- **数据来源**: 实际使用的数据源（Yahoo Finance / Alpha Vantage / Twelve Data）
- **当前持仓**: 实际持仓情况（空仓 / 持仓XXX股）
- **决策依据**: 根据信号和市场情况的判断
- **备注**: 特殊情况、系统问题、市场观察

### 每周回顾包含

#### 📊 自动分析的内容
- **市场表现**: 期初期末价格、涨跌幅、趋势判断
- **信号分析**: 信号活跃度、频率统计
- **最近信号**: 信号日期、类型、价格、策略表现评估
- **每日执行摘要**: 表格形式的每日记录

#### 🔍 需要完善的内容
- **策略评估**: 优势、问题
- **改进建议**: 根据本周表现提出改进方向
- **下周计划**: 策略调整计划

## 💡 最佳实践

### 1. 每日操作流程

```
08:00 - 运行日度策略
       ↓
       检查邮件通知
       ↓
       查看日志文件
       ↓
       填写手动信息（数据来源、持仓、决策依据）
       ↓
       添加备注（如有特殊情况）
```

### 2. 每周回顾流程（周日）

```
运行周回顾分析
   ↓
查看自动生成的报告
   ↓
分析策略表现
   ↓
完善策略评估（优势、问题）
   ↓
提出改进建议
   ↓
制定下周计划
```

### 3. 填写建议

#### 数据来源
记录实际使用的数据源，有助于评估不同数据源的可靠性：
- "Yahoo Finance - 正常获取"
- "Alpha Vantage - Yahoo Finance限频后切换"
- "Twelve Data - 前两个源都失败"

#### 决策依据
说明为什么做出这个决策：
- "无新信号，继续持仓观望"
- "出现BUY信号，但成交量异常低，暂不操作"
- "SELL信号+价格已达目标位，准备卖出"

#### 备注
记录任何异常或特殊情况：
- "数据更新较慢，可能是网络问题"
- "市场大幅波动，与特斯拉财报相关"
- "系统邮件发送延迟"

## 📊 示例

### 日志示例

```markdown
### 2025-11-14 (周四)

**执行信息**:
- 执行时间: 08:15
- 策略类型: 日度策略
- 数据更新: ✅ 成功

**数据状态**:
- 最新数据日期: 2025-11-13
- 数据完整性: ✅ 良好
- 数据来源: Yahoo Finance - 正常获取

**市场状态**:
- TSLA最新收盘: $429.52
- 价格变动: +1.23% (较前日)
- 成交量: 45,123,456
- 5日平均成交量: 42,345,678

**信号情况**:
- 最新信号日期: 2025-10-24
- 信号类型: SELL
- 信号价格: $433.72
- 信号原因: 趋势转弱
- 近7天信号数: 0

**策略决策**:
- 当前持仓: 空仓
- 操作建议: ✅ 观望 - 无新信号
- 决策依据: 
  - 已执行上次SELL信号，目前空仓
  - 价格在$430附近震荡，等待明确信号

**回顾分析**:
- 上次操作: 2025-10-24 SELL @ $433.72
- 当前价格: $429.52
- 价差: -$4.20 (-0.97%)
- 策略表现: ✅ 正确 - 卖出后价格下跌

**备注**:
- 数据获取顺畅，无异常
- 市场整体震荡，等待趋势明朗
```

### 周回顾示例

```markdown
## 📊 每周策略回顾 (2025-11-17)

**回顾周期**: 2025-11-11 至 2025-11-17 (共 7 天)

### 📈 市场表现

- **期初价格**: $425.30
- **期末价格**: $429.52
- **价格变化**: +$4.22 (+0.99%)
- **趋势判断**: 📈 上涨趋势

### 🎯 信号分析

- **信号活跃度**: 0/7 天有新信号
- **信号频率**: 💤 无信号

**最近信号**:
- 信号日期: 2025-10-24
- 操作类型: SELL
- 信号价格: $433.72
- 当前价格: $429.52
- 价差: -$4.20 (-0.97%)
- **策略表现**: ✅ 正确 - 卖出后价格下跌

### 📋 每日执行摘要

| 日期 | 最新价格 | 信号状态 | 操作建议 |
|------|---------|---------|---------|
| 2025-11-11 | $425.30 | ⚪ 无信号 | ✅ 观望 |
| 2025-11-12 | $426.15 | ⚪ 无信号 | ✅ 观望 |
| 2025-11-13 | $428.40 | ⚪ 无信号 | ✅ 观望 |
| 2025-11-14 | $429.52 | ⚪ 无信号 | ✅ 观望 |
| 2025-11-15 | $427.80 | ⚪ 无信号 | ✅ 观望 |
| 2025-11-16 | $428.90 | ⚪ 无信号 | ✅ 观望 |
| 2025-11-17 | $429.52 | ⚪ 无信号 | ✅ 观望 |

### 🔍 策略评估

**优势**:
- 上次SELL信号（10-24）执行正确，避免了后续下跌
- 当前空仓，等待合适买入时机
- 策略纪律性好，无信号期间保持观望

**问题**:
- 已20天无新信号，可能错过小幅波段机会
- 信号周期较长，对短期交易者不够友好

**改进建议**:
- 考虑添加短期交易信号（如5日/10日均线）
- 评估是否需要调整信号灵敏度
- 研究是否可以结合多个时间周期

### 📝 下周计划

- 继续观望，等待明确的BUY信号
- 关注价格是否突破$430阻力位
- 如果价格回落至$420，考虑是否调整策略参数
```

## 🔧 故障排查

### 日志文件不存在
- 确保已运行过 `daily_strategy_check.bat`
- 检查 `STRATEGY_EXECUTION_LOG.md` 是否在项目根目录

### 日志记录失败
- 检查Python环境是否正确
- 确认数据文件 `data/sample_tsla.csv` 存在
- 查看错误信息，排查具体原因

### 周回顾分析失败
- 确保至少有1天的日志记录
- 检查日志文件格式是否正确
- 确认日志条目包含必要的数据字段

## 📞 支持

如有问题，请检查：
1. Python环境配置
2. 数据文件完整性
3. 批处理文件执行权限
4. 日志文件格式正确性

---

**版本**: 1.0  
**更新日期**: 2025-11-13  
**维护者**: QT Trading System
