# ❗ 关于邮件通知的重要说明

## 📧 为什么没有收到邮件?

当你运行 `daily_strategy_check.bat` 后没有收到邮件,通常有以下几个原因:

---

### 原因1: 最近没有新信号 ✅ (正常情况)

**日度策略默认只检查最近1天的信号:**

- 如果最近1天内没有产生新的买卖信号
- 系统**不会发送邮件**
- 这是正常的,说明目前没有交易机会

**示例输出**:
```
✅ 最近没有新信号
   无需发送邮件
```

**这种情况下不用担心,系统正常运行!**

---

### 原因2: 数据未更新到最新 📅

**检查数据日期**:
```bash
# 查看最新数据日期
powershell -Command "Get-Content data\sample_tsla.csv -Tail 1"
```

如果最新数据不是今天:
1. 可能是非交易日(周末/节假日)
2. 数据源尚未更新
3. 数据下载失败

**解决方法**: 等待交易日结束后再运行

---

### 原因3: 139邮箱频率限制 ⚠️

**139.com邮箱有严格的发送频率限制:**

- 短时间内多次发送会被拒绝
- 错误信息: `Mail rejected, please try again`
- 建议每次发送间隔 **至少5分钟**

**如果遇到频率限制**:
1. 等待5-10分钟再试
2. 或者只在真正有新信号时才运行
3. 避免频繁测试邮件功能

---

## 🔍 如何确认系统工作正常?

### 方法1: 检查信号文件

```bash
# 查看最新信号
powershell -Command "Get-Content backtest_results\daily\signals_daily.csv -Tail 3"
```

如果最新信号日期是今天,说明有新信号

---

### 方法2: 手动测试邮件(扩大检查范围)

```bash
# 检查最近30天的信号(用于测试)
python -m src.pipeline.run_weekly_check_email --strategy daily --days 30
```

⚠️ **注意**: 这会发送历史信号的邮件,仅用于测试

---

## ✅ 正确的使用方式

### 每天自动运行

**方案A: Windows任务计划**
- 时间: 每天收盘后(如晚上7点)
- 动作: 运行 `daily_strategy_check.bat`
- 频率: 每天1次

**方案B: 手动运行**
- 每天收盘后手动双击 `daily_strategy_check.bat`
- 查看输出确认是否有新信号

---

### 邮件通知规则

| 情况 | 是否发邮件 | 说明 |
|:-----|:---------:|:-----|
| 有新信号 (今天产生) | ✅ 是 | 发送信号详情 |
| 无新信号 (今天没有) | ❌ 否 | 不发送邮件 |
| 非交易日 | ❌ 否 | 没有新数据 |
| 数据未更新 | ❌ 否 | 等待下次运行 |

---

## 🧪 测试邮件功能

**如果想测试邮件是否正常工作:**

1. **使用测试命令** (检查最近30天):
```bash
python -m src.pipeline.run_weekly_check_email --strategy daily --days 30
```

2. **查看输出**:
   - `✅ 发现 X 个新信号!` → 会尝试发送邮件
   - `✅ 最近没有新信号` → 不会发送邮件

3. **检查邮箱**:
   - 收件箱: qsoft@139.com
   - 也检查**垃圾邮件**文件夹
   - 邮件主题: `[TSLA策略] 🚨 日度策略 (动量交易) - TSLA 买入信号!`

---

## 💡 最佳实践

### 推荐配置

**日度策略**:
- 频率: 每天1次
- 时间: 收盘后(如晚7点)
- 检查范围: 最近1天 (默认)

**周度策略**:
- 频率: 每周1次  
- 时间: 周日晚8点
- 检查范围: 最近7天 (默认)

---

### 避免邮件限制

1. **不要频繁测试**: 139邮箱有发送限制
2. **只在需要时运行**: 设置自动任务,避免手动反复运行
3. **间隔至少5分钟**: 如果需要测试,每次间隔5分钟以上

---

## 📊 实际案例

### 案例1: 今天运行,无新信号

```
$ daily_strategy_check.bat

[步骤 1/3] 更新数据... ✓
[步骤 2/3] 运行策略... ✓
[步骤 3/3] 检查信号并发送邮件...

📊 检查最近 1 天的信号
策略: 日度策略 (动量交易)

✅ 最近没有新信号
   无需发送邮件

✅ 日度策略检查完成!
```

**结论**: 正常!今天没有交易信号,不发邮件

---

### 案例2: 有新信号,发送邮件

```
$ daily_strategy_check.bat

[步骤 1/3] 更新数据... ✓
[步骤 2/3] 运行策略... ✓
[步骤 3/3] 检查信号并发送邮件...

📊 检查最近 1 天的信号
策略: 日度策略 (动量交易)

✅ 发现 1 个新信号!

📧 发送邮件通知...
📧 正在连接邮件服务器...
📧 正在发送邮件...
✅ 邮件发送成功!

✅ 邮件已发送至: qsoft@139.com
```

**结论**: 成功!今天有新信号,邮件已发送,去邮箱查看

---

## ❓ 常见问题

### Q1: 为什么测试时说有2个信号,但我没收到邮件?

**A**: 
- 可能是139邮箱的频率限制
- 系统只会发送**最新的**那个信号邮件
- 检查垃圾邮件文件夹

---

### Q2: 数据最新日期是11月7日,今天是11月13日,怎么办?

**A**:
- 可能是非交易日(周末)
- 或者数据源尚未更新
- 等待交易日结束后再运行

---

### Q3: 如何知道上次运行的结果?

**A**: 查看信号文件的最后几行
```bash
powershell -Command "Get-Content backtest_results\daily\signals_daily.csv -Tail 3"
```

如果最后一行的日期是今天,说明今天有信号

---

## 📝 总结

### ✅ 正常情况

1. **运行批处理文件**
2. **数据更新成功**
3. **策略运行完成**
4. **检查发现无新信号**
5. **不发送邮件** ← 这是正常的!

### 📧 收到邮件的条件

只有满足**所有**条件才会收到邮件:
- ✅ 数据已更新到今天
- ✅ 今天产生了新的交易信号
- ✅ 139邮箱没有限制
- ✅ 邮件配置正确

---

**不要担心没收到邮件!大部分时候是因为没有交易信号,这是正常的! 🎯**

**日度策略每年平均只有22次交易,相当于每周0.4次,所以大部分时候都不会有信号!**
