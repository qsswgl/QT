# 邮件通知问题排查报告# ❗ 关于邮件通知的重要说明



## 📋 问题描述## 📧 为什么没有收到邮件?



用户运行了4个策略检查任务，但 **qsswgl@gmail.com** 没有收到策略邮件：当你运行 `daily_strategy_check.bat` 后没有收到邮件,通常有以下几个原因:

- TSLA日度策略

- TSLA周度策略  ---

- NVDA日度策略

- INTC日度策略### 原因1: 最近没有新信号 ✅ (正常情况)



## ✅ 邮件系统测试结果**日度策略默认只检查最近1天的信号:**



**测试时间**: 2025-11-14 20:50  - 如果最近1天内没有产生新的买卖信号

**测试状态**: ✅ 完全正常- 系统**不会发送邮件**

- 这是正常的,说明目前没有交易机会

```

✅ 网络连接: 通过**示例输出**:

✅ SMTP连接: 通过  ```

✅ 邮箱认证: 通过✅ 最近没有新信号

✅ 发送邮件: 通过   无需发送邮件

``````



**测试邮件已发送**: **这种情况下不用担心,系统正常运行!**

- 主题: [测试] QT量化交易系统 - 邮件功能测试

- 收件人: qsswgl@gmail.com---

- 状态: ✅ 发送成功

### 原因2: 数据未更新到最新 📅

## 🔍 问题原因分析

**检查数据日期**:

### 1. INTC脚本编码错误（已修复 ✅）```bash

# 查看最新数据日期

**问题**: INTC的邮件和日志脚本存在UTF-8编码错误powershell -Command "Get-Content data\sample_tsla.csv -Tail 1"

```

```

UnicodeDecodeError: 'utf-8' codec can't decode bytes如果最新数据不是今天:

```1. 可能是非交易日(周末/节假日)

2. 数据源尚未更新

**影响**: INTC策略在步骤3（发送邮件）时失败3. 数据下载失败



**解决**: **解决方法**: 等待交易日结束后再运行

- ✅ 删除损坏的 `run_daily_check_email_intc.py`

- ✅ 删除损坏的 `log_strategy_execution_intc.py`---

- ✅ 重新创建带正确UTF-8编码的文件

### 原因3: 139邮箱频率限制 ⚠️

### 2. 没有新信号（主要原因）

**139.com邮箱有严格的发送频率限制:**

策略邮件规则：

- **有新信号**（最近1天内）→ 发送🚨信号提醒邮件- 短时间内多次发送会被拒绝

- **没有新信号** → 发送✅每日总结邮件- 错误信息: `Mail rejected, please try again`

- 建议每次发送间隔 **至少5分钟**

NVDA策略显示：

```**如果遇到频率限制**:

[步骤 3/4] 🔍 检查新交易信号 (最近1天)...1. 等待5-10分钟再试

✓ 暂无新交易信号2. 或者只在真正有新信号时才运行

```3. 避免频繁测试邮件功能



**NVDA最新信号日期**: 2025-11-05（9天前）  ---

**结论**: 没有新信号，不会发送信号提醒邮件

## 🔍 如何确认系统工作正常?

## 📧 您应该收到的邮件

### 方法1: 检查信号文件

### 1. 测试邮件（刚刚发送）✅

```bash

**主题**: `[测试] QT量化交易系统 - 邮件功能测试`  # 查看最新信号

**状态**: 已发送  powershell -Command "Get-Content backtest_results\daily\signals_daily.csv -Tail 3"

**请检查**: ```

- Gmail主收件箱

- **垃圾邮件文件夹** ⚠️ 重点！如果最新信号日期是今天,说明有新信号



### 2. 策略每日总结邮件---



即使没有新信号，也应该收到每日总结：### 方法2: 手动测试邮件(扩大检查范围)



**主题**: `[XXX策略] ✅ 日度策略 - 每日总结`  ```bash

**可能位置**:# 检查最近30天的信号(用于测试)

- 垃圾邮件文件夹（最可能）python -m src.pipeline.run_weekly_check_email --strategy daily --days 30

- 促销标签页```

- 社交标签页

⚠️ **注意**: 这会发送历史信号的邮件,仅用于测试

## 🔧 立即检查步骤

---

### 步骤1: 检查邮箱

## ✅ 正确的使用方式

1. 登录 **qsswgl@gmail.com**

2. 检查**垃圾邮件**文件夹 ⚠️### 每天自动运行

3. 搜索: `from:qsswgl@gmail.com subject:策略`

4. 或搜索: `[测试]` 或 `[NVDA策略]` 或 `[INTC策略]`**方案A: Windows任务计划**

- 时间: 每天收盘后(如晚上7点)

### 步骤2: 标记为非垃圾邮件- 动作: 运行 `daily_strategy_check.bat`

- 频率: 每天1次

如果找到邮件在垃圾箱：

1. 打开邮件**方案B: 手动运行**

2. 点击"不是垃圾邮件"- 每天收盘后手动双击 `daily_strategy_check.bat`

3. 以后邮件会正常送达- 查看输出确认是否有新信号



### 步骤3: 重新运行修复后的INTC策略---



```powershell### 邮件通知规则

cd K:\QT\INTC

.\daily_strategy_check_intc.bat| 情况 | 是否发邮件 | 说明 |

```|:-----|:---------:|:-----|

| 有新信号 (今天产生) | ✅ 是 | 发送信号详情 |

运行完成后，再次检查邮箱（包括垃圾邮件）。| 无新信号 (今天没有) | ❌ 否 | 不发送邮件 |

| 非交易日 | ❌ 否 | 没有新数据 |

## 📊 验证信号情况| 数据未更新 | ❌ 否 | 等待下次运行 |



### 方法1: 查看信号文件---



```powershell## 🧪 测试邮件功能

# NVDA最后5个信号

Get-Content K:\QT\NVDA\backtest_results\daily\signals_daily.csv -Tail 5**如果想测试邮件是否正常工作:**



# INTC最后5个信号1. **使用测试命令** (检查最近30天):

Get-Content K:\QT\INTC\backtest_results\daily\signals_daily.csv -Tail 5```bash

```python -m src.pipeline.run_weekly_check_email --strategy daily --days 30

```

检查date列，看是否有今天或昨天的日期。

2. **查看输出**:

### 方法2: 查看执行日志   - `✅ 发现 X 个新信号!` → 会尝试发送邮件

   - `✅ 最近没有新信号` → 不会发送邮件

```powershell

# 打开NVDA日志3. **检查邮箱**:

notepad K:\QT\NVDA\STRATEGY_EXECUTION_LOG.md   - 收件箱: qsoft@139.com

   - 也检查**垃圾邮件**文件夹

# 打开INTC日志     - 邮件主题: `[TSLA策略] 🚨 日度策略 (动量交易) - TSLA 买入信号!`

notepad K:\QT\INTC\STRATEGY_EXECUTION_LOG.md

```---



查看最新条目的"信号情况"部分：## 💡 最佳实践

- **最新信号日期**: 如果是很久以前，就没有新信号

- **近7天信号数**: 如果是0，就没有新信号邮件### 推荐配置



## 💡 重要说明**日度策略**:

- 频率: 每天1次

### 📧 邮件发送规则- 时间: 收盘后(如晚7点)

- 检查范围: 最近1天 (默认)

| 情况 | 邮件类型 | 主题 |

|------|---------|------|**周度策略**:

| 有新信号（最近1天） | 🚨 信号提醒 | [XXX策略] 🚨 XXX 买入/卖出信号! |- 频率: 每周1次  

| 无新信号 | ✅ 每日总结 | [XXX策略] ✅ 日度策略 - 每日总结 |- 时间: 周日晚8点

| 执行出错 | ⚠️ 错误通知 | [XXX策略] ⚠️ 执行失败 |- 检查范围: 最近7天 (默认)



### 🎯 常见误解---



❌ **误解**: "运行策略就一定会收到信号邮件"  ### 避免邮件限制

✅ **正确**: 只有有新信号时才会收到**信号提醒**邮件

1. **不要频繁测试**: 139邮箱有发送限制

❌ **误解**: "测试邮件成功，策略邮件也一定在收件箱"  2. **只在需要时运行**: 设置自动任务,避免手动反复运行

✅ **正确**: Gmail可能把策略邮件标记为垃圾邮件3. **间隔至少5分钟**: 如果需要测试,每次间隔5分钟以上



❌ **误解**: "没收到邮件说明系统有问题"  ---

✅ **正确**: 可能是邮件在垃圾箱，或者没有新信号

## 📊 实际案例

## 🔄 完整测试流程

### 案例1: 今天运行,无新信号

如果想完整测试邮件系统：

```

```powershell$ daily_strategy_check.bat

# 1. 测试邮件系统

cd K:\QT[步骤 1/3] 更新数据... ✓

k:/QT/.venv/Scripts/python.exe src/notification/test_email_system.py[步骤 2/3] 运行策略... ✓

[步骤 3/3] 检查信号并发送邮件...

# 2. 运行NVDA策略（已测试过）

cd K:\QT\NVDA📊 检查最近 1 天的信号

.\daily_strategy_check_nvda.bat策略: 日度策略 (动量交易)



# 3. 运行INTC策略（刚修复）✅ 最近没有新信号

cd K:\QT\INTC   无需发送邮件

.\daily_strategy_check_intc.bat

✅ 日度策略检查完成!

# 4. 检查邮箱（包括垃圾邮件）```

```

**结论**: 正常!今天没有交易信号,不发邮件

## 📝 已修复的文件

---

### 1. src/pipeline/run_daily_check_email_intc.py

- ✅ 添加UTF-8编码声明### 案例2: 有新信号,发送邮件

- ✅ 重新创建文件

- ✅ 功能完整```

$ daily_strategy_check.bat

### 2. src/pipeline/log_strategy_execution_intc.py  

- ✅ 添加UTF-8编码声明[步骤 1/3] 更新数据... ✓

- ✅ 重新创建文件[步骤 2/3] 运行策略... ✓

- ✅ 功能完整[步骤 3/3] 检查信号并发送邮件...



### 3. src/notification/test_email_system.py（新建）📊 检查最近 1 天的信号

- ✅ 完整的邮件系统诊断工具策略: 日度策略 (动量交易)

- ✅ 测试网络、SMTP、认证、发送

- ✅ 提供详细的错误提示✅ 发现 1 个新信号!



## 🎉 总结📧 发送邮件通知...

📧 正在连接邮件服务器...

### ✅ 确认正常的部分📧 正在发送邮件...

✅ 邮件发送成功!

1. 邮件系统配置正确 ✅

2. 网络连接正常 ✅✅ 邮件已发送至: qsoft@139.com

3. SMTP服务器正常 ✅```

4. 邮箱认证成功 ✅

5. 邮件发送成功 ✅**结论**: 成功!今天有新信号,邮件已发送,去邮箱查看

6. INTC脚本已修复 ✅

---

### 🔍 最可能的情况

## ❓ 常见问题

1. **邮件在垃圾邮件文件夹**（80%可能性）

2. **没有新信号，所以没有信号提醒邮件**（60%可能性）### Q1: 为什么测试时说有2个信号,但我没收到邮件?

3. 两者都是（既没新信号，每日总结又在垃圾箱）

**A**: 

### 📋 您的行动清单- 可能是139邮箱的频率限制

- 系统只会发送**最新的**那个信号邮件

- [ ] 检查 qsswgl@gmail.com 主收件箱- 检查垃圾邮件文件夹

- [ ] ⚠️ 检查垃圾邮件文件夹（重点！）

- [ ] 搜索 "策略" 或 "测试" 关键词---

- [ ] 如果在垃圾箱，点击"不是垃圾邮件"

- [ ] 重新运行 INTC 策略### Q2: 数据最新日期是11月7日,今天是11月13日,怎么办?

- [ ] 查看策略日志确认信号日期

**A**:

## 🆘 如果仍然没收到- 可能是非交易日(周末)

- 或者数据源尚未更新

如果检查了所有地方都没有：- 等待交易日结束后再运行



1. **确认邮箱地址**: 是 qsswgl@gmail.com 吗？---

2. **查看Gmail所有邮件**: 左侧 → "所有邮件"

3. **检查过滤器**: Gmail设置 → 过滤器和屏蔽的地址### Q3: 如何知道上次运行的结果?

4. **再次运行测试**: `test_email_system.py`

5. **查看日志**: 策略运行时的完整输出**A**: 查看信号文件的最后几行

```bash

## 📞 支持powershell -Command "Get-Content backtest_results\daily\signals_daily.csv -Tail 3"

```

如需帮助，提供以下信息：

1. 邮箱检查结果（收件箱/垃圾邮件/都没有）如果最后一行的日期是今天,说明今天有信号

2. 最新信号日期（从STRATEGY_EXECUTION_LOG.md）

3. 策略运行的完整终端输出---

4. `test_email_system.py` 的运行结果

## 📝 总结

---

### ✅ 正常情况

**报告时间**: 2025-11-14 20:50  

**系统状态**: ✅ 邮件系统正常  1. **运行批处理文件**

**测试邮件**: ✅ 已发送  2. **数据更新成功**

**INTC修复**: ✅ 已完成  3. **策略运行完成**

**下一步**: 检查邮箱垃圾邮件文件夹4. **检查发现无新信号**

5. **不发送邮件** ← 这是正常的!

### 📧 收到邮件的条件

只有满足**所有**条件才会收到邮件:
- ✅ 数据已更新到今天
- ✅ 今天产生了新的交易信号
- ✅ 139邮箱没有限制
- ✅ 邮件配置正确

---

**不要担心没收到邮件!大部分时候是因为没有交易信号,这是正常的! 🎯**

**日度策略每年平均只有22次交易,相当于每周0.4次,所以大部分时候都不会有信号!**
